<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Sentence Gen 2</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
	database = {
		verb: [
			{name: "be", trans: 1, class: "state", tense: {past: "was", present: "is"}},
			{name: "walk", trans: 0, class: "activity", tense: {}}
		],	
		noun: [
			{name: "Jack", proper: 1, anim: 4},
			{name: "dog", proper: 0, anim: 3}
		]
	}
	
	
	C = new node(copula)
	
	$(document).ready(function(e) {
		$("body").html(C.toString())
	})
	
	
	
	function copula(){
			this.order = "subject nucleus object"
			this.head = "nucleus"
			
			return {
				nucleus: [VP, {name: "be"}],
				subject: [NP],
				object: [NP]
			}
	}
	
	function VP(){
		
		this.order = "verb"
		this.head = "verb"
		
		return {
			verb: [V]
		}
	}
	
	function NP(){
		
		this.order = "noun"
		this.head = "noun"
		
		return {
			noun: [N]
		}

	}

	
	function V(){
		var r = this.r
		
		this.word = getWord("verb", r)
		this.text = this.word.name
		
		//if no tense is specified, specify one randomly
		if(!r.hasOwnProperty(tense)){
			r.tense = pickOne("future present past".split(" "))
		}
		
		if(r != undefined && r.tense){
			//rename the name of the verb to be the tense variation
			if (!(this.word.tense[r.tense])){
				if(r.tense == "past"){
						this.text += "ed";
				}
				if(r.tense == "future"){
						this.text = "will "+this.text;
				}
			} else { //this verb does have a irregular tense
				this.text = this.word.tense[r.tense]	
			}
		}
	}
	
	function N(){
		var r = this.r
		
		this.word = getWord("noun", r)
		this.text = this.word.name
	}
	
	function getWord(type, r){
		var word = $.extend({}, pickOne(database[type]))
		
		return word
	}

	function node(c, r, p, l){
		this.parent = p || null
		this.label = l || c.name
		this.r = r || null
		this.toString = toString
		
		this.c = c
		this.children = this.c(r)
		if (!this.children) return
		
		if(c.hasOwnProperty("head")){
			//evaluate head first
			this.head = this.children[c.head] = new node(this.children[c.head][0],$.extend(1, r, this.children[c.head][1]), this, c.head)
		} else {
			this.c()
		}
		
		
		
		//evaluate rest of children
		for(var child in this.children){		
			if(child != c.head){ this.children[child] = new node(this.children[child][0], this.children[child][1], this, child) }
		}
		
		function toString(){
			if(this.text) return this.text
			
			var string = ""
			
			var children = this.order.split(" ")
			
			for (ch in children) {
				string += this.children[children[ch]].toString() + " "
			}
			
			return string
		}
	}
	
	//utility function for randomly picking one element from an array
	function pickOne(arr){
		return arr[Math.floor(Math.random()*arr.length)]	
	}
	
</script>
</head>

<body>
</body>
</html>